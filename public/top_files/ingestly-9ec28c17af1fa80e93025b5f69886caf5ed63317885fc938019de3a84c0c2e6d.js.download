!function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function g(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var n,o,r,h,w,y,k,b,T,S,C,L,I,M,a=function(e,t){var n=new XMLHttpRequest;"function"==typeof t&&(n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e;try{e=JSON.parse(n.response)}catch(e){return e}t.call(null,e)}}),n.open("GET",e,!0),n.timeout=4e3,n.withCredentials=!0;try{n.send()}catch(e){}return!0},i=function(e,n){return"object"===t(n)&&(n=JSON.stringify(n)),void 0!==n&&""!==n&&"{}"!==n?"&".concat(e,"=").concat(encodeURIComponent(n)):""},c=!0,d=function(){function t(e,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(){for(var e=(+new Date).toString(36),t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n="",o=0;16>o;o++)n+=t[Math.floor(Math.random()*t.length)];return"".concat(e,"-").concat(n)}(),n=e,o=a}var d,s;return d=t,(s=[{key:"emit",value:function(e,t){if(o){var d=function(e,t){var o="https://".concat(n,"/api/application_event");for(var a in o+="?rootId=".concat(r),t)o+=i(a,t[a]);return o}(0,t);if("sendBeacon"in navigator&&"function"==typeof navigator.sendBeacon&&!0===c){try{c=navigator.sendBeacon(d)}catch(e){c=!1}if(!c)if("function"==typeof window.fetch&&"function"==typeof window.AbortController){var s=new AbortController,l={signal:s.signal,method:"POST",cache:"no-store",keepalive:!0};setTimeout(function(){return s.abort()},4e3);try{window.fetch(d,l)}catch(e){}}else a(d)}else a(d)}}}])&&e(d.prototype,s),t}(),l={},u=0,m=function(){function e(t){var n,o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.en&&t.ef>0){try{n=new CustomEvent(t.en)}catch(e){(n=window[t.tw].document.createEvent("CustomEvent")).initCustomEvent(t.en,!1,!1,{})}window[t.tw].requestAnimationFrame=window[t.tw].requestAnimationFrame||window[t.tw].mozRequestAnimationFrame||window[t.tw].webkitRequestAnimationFrame,function e(){return window[t.tw].requestAnimationFrame(e),o?!1:(o=setTimeout(function(){window[t.tw].dispatchEvent(n),o=null},t.ef),void 0)}()}}var t,n;return t=e,(n=[{key:"addListener",value:function(e,t,n,o){return e.addEventListener(t,n,o),l[u]={element:e,type:t,listener:n,capture:o},u++}},{key:"removeListener",value:function(e){if(e in l){var t=l[e];t.element.removeEventListener(t.type,t.listener,t.capture)}}}])&&s(t.prototype,n),e}(),v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"getPerformanceInfo",value:function(e){if("navigation"in window[e].performance&&"timing"in window[e].performance){var t=window[e].performance.timing,n=window[e].performance.navigation,o=t.domLoading,r=t.domInteractive-o,a=t.domContentLoadedEventStart-o,i=t.domComplete-o,c=+new Date-o;return{ptTti:r>=0?r:void 0,ptDcl:a>=0?a:void 0,ptComplete:i>=0?i:void 0,ptElapsedMs:c>=0?c:void 0,nvType:n.type,nvRdCnt:n.redirectCount}}return{}}},{key:"getClientInfo",value:function(e){var t=screen.orientation||screen.mozOrientation||screen.msOrientation||"not-supported";return"object"===f(t)&&(t=t.type),{vpHeight:window[e].innerHeight,vpWidth:window[e].innerWidth,scHeight:window[e].screen.height,scWidth:window[e].screen.width,scOrientation:t}}},{key:"getMediaInfo",value:function(e){return!!e&&{mdSrc:e.src,mdCurrentTime:Math.round(10*e.currentTime)/10,mdDuration:Math.round(10*e.duration)/10,mdPlayedPercent:Math.round(1e3*(e.currentTime/e.duration))/10,mdAttr:{type:e.type||void 0,width:e.clientWidth||void 0,height:e.clientHeight||void 0,muted:e.muted||!1,defaultMuted:e.defaultMuted||!1,autoplay:e.autoplay||!1,playerId:e.playerId||void 0,dataset:e.dataset}}}},{key:"getFormStats",value:function(e,t,n,o){var r=n.name||n.id||"-",a=0;if("select"===n.tagName.toLowerCase())for(var i=0;i<n.length;i++)n[i].selected&&a++;else a="input"!==n.tagName.toLowerCase()||"checkbox"!==n.type&&"radio"!==n.type?n.value.length:n.checked?1:0;return"hidden"!==n.type&&(e.fmItems[r]={status:t,length:a}),e.fmFirstItem||(e.fmFirstItem=n.name||n.id||"-",e.fmStartedSinceInitMs=+new Date-o),e.fmLastItem=n.name||n.id||"-",e.fmEndedSinceInitMs=+new Date-o,e.fmDurationMs=e.fmEndedSinceInitMs-e.fmStartedSinceInitMs,e}},{key:"getVisibility",value:function(e,t){var n=0,o={};try{o=e.getBoundingClientRect(),n=e.innerText.length}catch(e){o={}}var r=window[t].innerHeight,a=window[t].document.documentElement.scrollHeight,i=window[t].document.visibilityState||"unknown",c="pageYOffset"in window[t]?window[t].pageYOffset:(window[t].document.documentElement||window[t].document.body.parentNode||window[t].document.body).scrollTop,d=c+r,s=o.height,l=o.top<=0?0:o.top,u=-1*(o.bottom-r)<=0?0:-1*(o.bottom-r),m=d,f=d/a,p=null,v=null,g=!1;return o.top>=0&&o.bottom>r&&o.top>=r?(p=null,v=null,g=!1):o.top>=0&&o.bottom>r&&o.top<r?(p=0,v=r-o.top,g=!0):o.top<0&&o.bottom>r?(v=(p=-1*o.top)+r,g=!0):o.top>=0&&o.bottom<=r?(p=0,v=s,g=!0):o.top<0&&o.bottom>=0&&o.bottom<=r?(p=s+o.top,v=s,g=!0):o.top<0&&o.bottom<0?(p=null,v=null,g=!1):g=!1,{dHeight:a,dIsVisible:i,dVisibleTop:c,dVisibleBottom:d,dScrollUntil:m,dScrollRate:f,tHeight:s,tVisibleTop:p,tVisibleBottom:v,tMarginTop:l,tMarginBottom:u,tScrollUntil:v,tScrollRate:v/s,tViewableRate:(v-p)/s,tIsInView:g,tLength:n}}},{key:"queryMatch",value:function(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="button",i=[];for(3===t.nodeType&&(t=t.parentNode);t&&t!==window[r].document;){var c=(t.matches||t.msMatchesSelector||function(){return!1}).bind(t);if(o)t.hasAttribute(o)&&i.unshift(t.getAttribute(o));else{var d=t.tagName.toLowerCase();"html"!==d&&"body"!==d&&(t.id&&(d+="#".concat(t.id)),t.className&&(d+=".".concat(t.className)),i.unshift(d))}!n&&c(e)&&(a="a"===t.tagName.toLowerCase()?"link":t.tagName.toLowerCase(),n=t),t=t.parentNode}return!!(n&&i.length>0)&&{element:n,category:a,path:i.join(">")}}},{key:"mergeObj",value:function(e){for(var t={},n=0;n<e.length;n++)for(var o in e[n])t[o]="object"!==f(e[n][o])||null===e[n][o]||Array.isArray(e[n][o])?Array.isArray(e[n][o])?t[o]?t[o].concat(e[n][o]):e[n][o]:e[n][o]:t[o]?this.mergeObj([t[o],e[n][o]]):e[n][o];return t}},{key:"parseUrl",value:function(e){var t,n={},o=document.createElement("a");return e&&(o.href=e,t=o.search.slice(1).split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}),n={Protocol:o.protocol,Host:o.hostname,Port:o.port,Path:o.pathname,Search:o.search,Hash:o.hash,Query:t}),n}},{key:"readCookie",value:function(e,t){for(var n=window[t].document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf("".concat(e,"=")))return r.substring("".concat(e,"=").length,r.length)}return""}}],n&&p(t.prototype,n),e}(),A="1.0.4",R=+new Date,O={media:[],form:[]},N=R,F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataModel={},this.trackReadTargets=[],this.trackFormTargets=[]}var t,n;return t=e,n=[{key:"config",value:function(e){h=e,T=new v,k=new d(h.endpoint,h.allowSendBeacon),w=h.targetWindow||"self",S=T.parseUrl(window[w].document.location.href),C=T.parseUrl(window[w].document.referrer),L="onbeforeunload"in window[w]?"beforeunload":"onpagehide"in window[w]?"pagehide":"unload",I=h.appName,M=h.env}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dataModel=e,this.dataModel.sdk="JS-".concat(A),this.dataModel.appName=I,this.dataModel.env=M;try{y=JSON.parse(decodeURIComponent(T.readCookie("ingestlyConsent",w)))}catch(e){y={}}for(var t in S)this.dataModel["ur".concat(t)]=S[t];for(var n in C)this.dataModel["rf".concat(n)]=C[n];void 0===b&&(b=new m({en:h.eventName,ef:h.eventFrequency,tw:w})),h.options&&(h.options.rum&&h.options.rum.enable&&("interactive"===window[w].document.readyState||"complete"===window[w].document.readyState?this.trackAction("rum","page",{}):this.trackPerformance()),h.options.unload&&h.options.unload.enable&&this.trackUnload(),h.options.scroll&&h.options.scroll.enable&&this.trackScroll(),h.options.read&&h.options.read.enable&&(this.trackReadTargets=[].slice.call(h.options.read.targets),this.trackRead()),h.options.clicks&&h.options.clicks.enable&&this.trackClicks(),h.options.media&&h.options.media.enable&&this.trackMedia(),h.options.form&&h.options.form.enable&&(this.trackFormTargets=[].slice.call(h.options.form.targets),this.trackForm()))}},{key:"setConsent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;!1===e.cookie?(t=1,y.cookie=!1):y.cookie=e.cookie?e.cookie:h.useCookie,y.measurement=!1===e.measurement?!1:!0,y.measurement=!e.measurement,k.emit("consent",{dc:t,ap:encodeURIComponent(JSON.stringify(e))})}},{key:"trackAction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=+new Date,r={action:e,category:t,sinceInitMs:o-R,sincePrevMs:o-N,consent:y},a=T.mergeObj([this.dataModel,r,n,T.getClientInfo(w),"performance"in window[w]?T.getPerformanceInfo(w):{}]);a.ck=!0===y.cookie?!0:!1===y.cookie?!1:!!h.useCookie,N=o,!1!==y.measurement&&k.emit("ingest",a)}},{key:"trackPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.trackAction("view","page",e)}},{key:"trackPerformance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.removeListener(O.performance),O.performance=b.addListener(window[w].document,"DOMContentLoaded",function(){e.trackAction("rum","page",t)},!1)}},{key:"trackUnload",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.removeListener(O.unload),O.unload=b.addListener(window[w],L,function(){e.trackAction("unload","page",t)},!1)}},{key:"trackClicks",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.removeListener(O.click),O.click=b.addListener(window[w].document.body,"click",function(n){var o=h.options.clicks.targetAttr||!1,r=T.queryMatch('a, button, div, [role="button"]',n.target,o,w),a=null;if(r){var i={clTag:(a=r.element).tagName,clId:a.id||void 0,clClass:a.className||void 0,clPath:r.path||void 0,clLink:a.href||void 0,clText:a.innerText||a.value||void 0,clAttr:a.dataset||void 0};e.trackAction("click",r.category,T.mergeObj([i,t]))}},!1)}},{key:"trackScroll",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=h.options.scroll.granularity||20,o=100/n,r=1e3*h.options.scroll.threshold||2e3,a={},i=0,c=0,d="percent";b.removeListener(O.scroll),O.scroll=b.addListener(window[w],h.eventName,function(){"hidden"!==(a=T.getVisibility(null,w)).dIsVisible&&"prerender"!==a.dIsVisible&&("percent"===h.options.scroll.unit?i=Math.floor(a.dScrollRate*o)*n:(i=a.dScrollUntil,d="pixel"),("percent"===d&&i>c&&i>=0&&100>=i||"pixel"===d&&i>c&&i>=n)&&setTimeout(function(){if(i>c){var o={pgH:a.dHeight,srDepth:i,srUnit:d};e.trackAction("scroll","page",T.mergeObj([o,t])),c="percent"===d?i:i+n}},r))},!1)}},{key:"trackRead",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.trackReadTargets&&0!==this.trackReadTargets.length){var n=h.options.read.granularity||20,o=100/n,r=1e3*h.options.read.threshold||2e3,a=[],i=[],c=[];b.removeListener(O.read),O.read=b.addListener(window[w],h.eventName,function(){for(var d=function(d){i[d]=i[d]||0,c[d]=c[d]||0,a[d]=T.getVisibility(e.trackReadTargets[d],w),"hidden"!==a[d].dIsVisible&&"prerender"!==a[d].dIsVisible&&a[d].tIsInView&&(i[d]=Math.floor(a[d].tScrollRate*o)*n,i[d]>c[d]&&i[d]>=0&&i[d]<=100&&setTimeout(function(){if(i[d]>c[d]&&e.trackReadTargets[d]){var n={rdIdx:d,rdId:e.trackReadTargets[d].id||void 0,rdTxS:e.trackReadTargets[d].innerText.substring(0,12)||void 0,rdTgH:a[d].tHeight,rdTxL:a[d].tLength,rdRate:i[d],rdAttr:e.trackReadTargets[d].dataset||void 0};e.trackAction("read","content",T.mergeObj([n,t])),100===i[d]&&e.trackReadTargets.splice(d,1),c[d]=i[d]}},r))},s=0;s<e.trackReadTargets.length;s++)d(s)},!1)}}},{key:"trackMedia",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=["play","pause","ended"],o=h.options.media.heartbeat||5,r={},a=0;a<n.length;a++)b.removeListener(O.media[n[a]]),O.media[n[a]]=b.addListener(window[w].document.body,n[a],function(n){var o=T.getMediaInfo(n.target);e.trackAction(n.type,n.target.tagName.toLowerCase(),T.mergeObj([o,t]))},{capture:!0});b.removeListener(O.media.timeupdate),O.media.timeupdate=b.addListener(window[w].document,"timeupdate",function(n){return r[n.target.src]?!1:(r[n.target.src]=setTimeout(function(){if(!0!==n.target.paused&&!0!==n.target.ended){var o=T.getMediaInfo(n.target);e.trackAction(n.type,n.target.tagName.toLowerCase(),T.mergeObj([o,t]))}r[n.target.src]=!1},1e3*o),void 0)},{capture:!0})}},{key:"trackForm",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.trackFormTargets&&0!==this.trackFormTargets.length)for(var n=["focus","change"],o=function(o){for(var r={fmName:e.trackFormTargets[o].name||e.trackFormTargets[o].id||"-",fmAttr:e.trackFormTargets[o].dataset,fmItems:{}},a=function(t){b.removeListener(O.form[n[t]]),O.form[n[t]]=b.addListener(e.trackFormTargets[o],n[t],function(e){r=T.getFormStats(r,n[t],e.target,R)},!0)},i=0;i<n.length;i++)a(i);b.removeListener(O.form_emit),O.form_emit=b.addListener(window[w],L,function(){e.trackAction("stats","form",T.mergeObj([r,t]))},!1)},r=0;r<this.trackFormTargets.length;r++)o(r)}},{key:"getQueryVal",value:function(e){return S.Query[e]?S.Query[e]:""}}],n&&g(t.prototype,n),e}();window.Ingestly=new F}();